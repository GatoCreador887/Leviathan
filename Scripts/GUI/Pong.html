<html>
	<head>
        <meta charset="utf-8">
		<title>Menu</title>
        <link rel="stylesheet" href="./../jQuery/ui-lightness/jquery-ui-1.10.4.custom.css"/>
        <link rel="stylesheet" type="text/css" media="all" href="Pong.css"/>

        
        <!--Using jQuery, should probably change to min jQuery for release-->
        <!--<script src="./../jQuery/jquery-2.1.0.min.js" type="text/javascript"></script>-->
        <script src="./../jQuery/jquery-2.1.0.js"></script>
        <!--<script src="./../jQuery/jquery-ui-1.10.4.custom.min.js" type="text/javascript"></script>-->
        <script src="./../jQuery/jquery-ui-1.10.4.custom.js"></script>
	</head>
<body>
    <script>
    // ------------------ Ease of use functions ------------------ //
    function GetErrorElementForError(errorstring, customclass){
    
        return "<div class='ui-state-error ui-corner-all "+customclass+"' style='padding: 0 .7em;'><p><span class='ui-icon ui-icon-alert' style='float: left; margin-right: .3em; vertical-align: middle;'></span>"+
        "<strong>Error:</strong> "+errorstring+"</p></div>";
    }
    
    
    $(document).ready(function() {
        // Register the listeners //
        $(".GameTitle").on("click", function() {
            $(this).fadeOut();
        });
        
        // ------------------ TopLevelMenu ------------------ //
        $("#ServerStartButton").on("click", function() {
            $("#TopLevelMenu").slideUp();
            $("#ServerStartScreen").slideDown();
        });
        $("#DirectConnectButton").on("click", function() {
            $("#TopLevelMenu").slideUp();
            $("#DirectConnectScreen").slideDown();
        });
        $("#QuitButton").on("click", function() {
            Leviathan.Quit();
        });
        
        
        
        // ------------------ ServerStartScreen ------------------ //
        $("#BackFromServerStartScreen").on("click", function() {
            $("#ServerStartScreen").slideUp();
            $("#TopLevelMenu").slideDown();
        });
        
        // ------------------ DirectConnectScreen ------------------ //
        $("#BackFromDirectConnectScreen").on("click", function() {
            $("#DirectConnectScreen").slideUp();
            $("#TopLevelMenu").slideDown();
        });
        
        $("#ServerConnectButton").button().click(function( event ) {
            // prevent default and try to handle it //
            event.preventDefault();
            
            // Try to start connecting //
            ConnectToServer($("#ServerAddressBox").val(), function(){
                // Change to the right place //
                console.log("Trying to display server connect screen");
                
                $("#ServerConnectScreen").slideDown();
                $("#DirectConnectScreen").slideUp();
                
            }, function(errorcode, errortext){
                $("#DirectConnectFormErrorText").html(GetErrorElementForError(errortext, "SmallError"));
            });
            

        });
        
        // ------------------ ServerConnectScreen ------------------ //
        $("#ServerConnectScreenDisconnect").on("click", function(){
            // Display the menu //
            $("#TopLevelMenu").slideDown();
            $("#ServerConnectScreen").slideUp();
            
            // Disconnect //
            Disconnect();
        });
        // Updating messages //
        Leviathan.OnGeneric("ConnectStatusMessage", function(eventtypename, variables){
            // Set the value to the text box //
            $("#ConnectionStatusUpdate").html(variables.Message);
        });
        
        // ------------------ LobbyScreen ------------------ //
        $("#LobbyDisconnect").on("click", function(){
            // All the right ones will be automatically opened/closed //
            
            // Disconnect //
            Disconnect();
        });
        
        // Create tabs //
        $("#LobbyTabs").tabs({ event: "mouseover" });
        
        // Detect Lobby screen state update //
        Leviathan.OnGeneric("LobbyScreenState", function(name, variables){
            // Check is it going on or off //
            if(variables.State == "On"){
            
                $("#LobbyScreen").slideDown();
                $("#ServerConnectScreen").slideUp();
                
            } else if(variables.State == "Off"){
                
                $("#TopLevelMenu").slideDown();
                $("#LobbyScreen").slideUp();
            }
        });
        
        
        // ------------------------------------ //
        // Put version numbers //
        GetPongVersion(function(response){
            $(".GameTitle").append("<p class='WeakText' style='margin-top: -15px; margin-left: 50px;'>"
                +response+"</p>");
        }, function() {});

        Leviathan.GetVersion(function(response){ 
            $("body").append("<div class='WeakText' style='position: absolute; right: 0%; bottom: 0%;' id='PongVersion'>"
                +"Leviathan "+response+"</div>");
        }, function() {});
        

        
    });
    
    </script>
    
    <div id="Menus">
        <div class="MenuContent" id="TopLevelMenu">
            <span class="GameTitle">Pong</span>
            
            <div class="MenuOption" id="ServerStartButton">Start Server</div>
            <div class="MenuOption Disabled" id="BrowseGamesButton">Browse Games</div>
            <div class="MenuOption" id="DirectConnectButton">Direct Connect</div>
            <div class="MenuOption Dangerous" id="QuitButton">Quit</div>
        </div>
        <div class="MenuContent Hidden" id="ServerStartScreen">
            <h1 class="MenuTitle">Start a new game</h1>
            <hr class="MenuLine">
            Here's the server setup screen!
            <hr class="MenuLine">
            <span class="MenuOption" id="ServerStartButton">Start Game</span>
            <span class="MenuOption" id="BackFromServerStartScreen">Back</span>
        </div>
        <div class="MenuContent Hidden" id="DirectConnectScreen">
            <h1 class="MenuTitle">Connect to a server</h1>
            <hr class="MenuLine">
            <form id="DirectConnectForm" style="text-align: center; width: auto; margin: auto;">
            <p id="DirectConnectFormErrorText">Type in the address of the server like this: "192.168.1.1:25543"</p>
            <input id="ServerAddressBox" style="font-size: 35; height: auto;" type="text" size="30" name="ServerAddress" 
                value="localhost:53221">
            <p><input type="submit" value="Connect" id="ServerConnectButton"></p>
            </form>
            <span class="MenuOption" id="BackFromDirectConnectScreen">Back</span>
        </div>
    </div>
    <div class="Hidden" id="LobbyScreen">
        
        <div id="LobbyTabs" class="LobbyTabs">
            <ul>
                <li><a href="#OverviewTab">Overview</a></li>
                <li><a href="#SlotsTab">Player slots</a></li>
                <li><a href="#Team0Tab">Team 0</a></li>
                <li><a href="#Team1Tab">Team 1</a></li>
                <li><a href="#Team2Tab">Team 2</a></li>
                <li><a href="#Team3Tab">Team 3</a></li>
                <li><a href="#TeamlessTab">Teamless players</a></li>
            </ul>
            <div class="LobbyTContent" id="OverviewTab">
                <p>
                    You are connected to a server.<br>
                    Put team overviews here.
                    Add start match button
                </p>
            </div>
            <div class="LobbyTContent" id="SlotsTab">
                <p>
                    Add controls for slot splitting, open teams and AI adding
                </p>
            </div>
            <div class="LobbyTContent" id="Team0Tab">
                <p>
                    Add buttons to join team 0
                </p>
            </div>
            <div class="LobbyTContent" id="Team1Tab">
                <p>
                    Add buttons to join team 1
                </p>
            </div>
            <div class="LobbyTContent" id="Team2Tab">
                <p>
                    Add buttons to join team 2
                </p>
            </div>
            <div class="LobbyTContent" id="Team3Tab">
                <p>
                    Add buttons to join team 3
                </p>
            </div>
            <div class="LobbyTContent" id="TeamlessTab">
                <p>
                    TODO: put teamless players here for easy checking if all players have joined
                </p>
            </div>
        </div>
        
        <div id="LobbyChat" class="ChatBox">
            Chat content goes here<br>
            Lines like these<br>
            many<br>
            many<br>
            many lines<br>
            and then some<br>
            come on be too long...<br>
            .<br>
            .<br>
            .<br>
            .<br>
            .<br>
            message<br>
        </div>
        
        <span class="LobbyDisconnect Dangerous" id="LobbyDisconnect">Disconnect</span>
        

        
    </div>
    <div class="Hidden" id="ServerConnectScreen">
        <span class="DeadCenter" style="margin-top: 10%; width: 100%;">
            Connecting to a server
        </span>
        <div class="ConnectStatus" id="ConnectionStatusUpdate">
            Waiting for a status update...
        </div>
        <div class="BottomRightMenu Dangerous" style="width: auto;" id="ServerConnectScreenDisconnect">
            Disconnect
        </div>
    </div>
    <div class="Hidden" id="GameplayHUD">
        <span class="PlayerDisplayColour" style="paddin-left: 5px; position: absolute; top: 5%; left: 5%; width: 20%; min-height: 100px;">
        <p id="HUDPlayerScoreList"></p>
        </span>
    </div>
    <div class="Hidden" id="MatchEndScreen">
        <div class="MenuContent">
        <h1 class="MenuTitle">Match has ended</h1>
        <hr class="MenuLine"></hr>
        <h2 class="MenuTitle">Winners</h2>
        
        <p class="Golden PlayerDisplayColour" id="PlayerWinnerList"></p>
        
        <hr class="MenuLine"></hr>
        <h2 class="MenuTitle">Final scores</h2>
        <p id="WinningScreenScoreboard"></p>
        
        <span class="MenuOption"><p id="WinningGameToLobby">Lobby</p></span>
        <br></br>
        <span class="MenuOption"><p id="WinningGameBackToMenuButton">Main menu</p></span>
        <span class="MenuOption Dangerous"><p id="GameQuitFromWinScreen">Quit game</p></span>
        </div>
    </div>
    <div class="Hidden" id="PauseMenu">
        <span class="SpaceTaker"></span>
        <div class="MenuContent PauseContent">
        <h1 class="MenuTitle">(Potentially) Paused</h1>
        <hr class="MenuLine PauseLine"></hr>
        <span class="MenuOption PauseOption"><p id="ClosePauseMenu">Resume</p></span>
        <br></br>
        <span class="MenuOption PauseOption"><p id="PauseScreenBackToMenuButton">Main menu</p></span>
        <span class="MenuOption PauseOption Dangerous"><p id="PauseScreenQuitButton">Quit game</p></span>
        </div>
    </div>
    
</body>
</html>